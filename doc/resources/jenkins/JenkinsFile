node {
    withEnv(['AZURE_SUBSCRIPTION_ID=3f1d8a91-940f-4c9d-b8d7-b146893bbd27',
            'AZURE_TENANT_ID=72f988bf-86f1-41af-91ab-2d7cd011db47']) {
        stage('Init') {
            cleanWs()
            checkout scm
        }

        stage('Build') {
            sh 'mvn clean package'
        }

        stage('Publish') {
            def RESOURCE_GROUP = 'ymlCxLinux' 
            def FUNC_NAME = 'repro8234'
            // login Azure
            withCredentials([azureServicePrincipal('credentials_id')]) {
            sh 'az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID'
         }   
         sh 'cd $PWD/target/azure-functions/odd-or-even-function-sample && zip -r ../../../archive.zip ./* && cd -'
         sh "az functionapp deployment source config-zip -g $RESOURCE_GROUP -n $FUNC_NAME --src archive.zip"
         sh 'az logout'
       }
    }
}
